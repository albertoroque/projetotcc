<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
	
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.Jcrop.js"></script>	
	<link rel="stylesheet" href="css/jquery.Jcrop.css" type="text/css" />
</head>
<body>
	<style type="text/css">
		
		.thumbnail-img{height: auto;width: 100%;}
		.img-canvas{width: 100%;height: auto;}
		.img-canvas img{width: 100%;}		
		
	</style>
	
	<!-- div for cut -->
	<div class="imgToThumb">    	
    	<img id="canvasToThumb" 
    	class='thumbnail-img' 
    	crossorigin="anonymous" 
    	src="https://static.pexels.com/photos/2324/skyline-buildings-new-york-skyscrapers.jpg" />
	</div>


	<button id="loadJcrop">CORTAR</button>
	<button id="crop">TERMINAR CORTE</button>	
	<button id="hideJcrop">CANCELAR</button>

	<p>obs: desabilitar botões</p>

	<!-- espaço para renderização de imagem -->
	<div style="display:none;"><canvas id="canvas"></canvas></div>

	<!-- preview da imagem -->
	<div id="divimg" class="img-canvas"> </div>

	<script>
	// Create variables (in this scope) to hold the API and image size
	var jcrop_api, boundx, boundy;
	var coords;

	var width_cropper = document.getElementById("canvasToThumb").width;

	var canvas = document.getElementById("canvas");	   
	var context = canvas.getContext("2d");

	function showCoords(c) { // show all coords	    
	    coords = c;
	}

	$("#loadJcrop").on("click", function(){			  
		$('.thumbnail-img').Jcrop({	    
		    onSelect: showCoords,
		    bgFade: true,
		    bgOpacity: .3,
		    setSelect: [ width_cropper, 0, 0, 0 ],	   
		    aspectRatio: 4
		},function(){	    	       
	      jcrop_api = this;     
		});

	});

	$("#hideJcrop").on("click", function(){			  
		hideJcrop();
	});

	function hideJcrop(){		
		if(jcrop_api){
			jcrop_api.destroy();
			$('.imgToThumb .thumbnail-img').removeAttr('style');
			$('.imgToThumb .jcrop-holder').remove();
			width_cropper = document.getElementById("canvasToThumb").width;        		
    	}
	}

	$(window).resize(function(){
		hideJcrop();
		console.log('RESIZE');	 
	});

	$("#crop").on("click", function(){
	    	    
	   	//espaõ da imagem cortada
	    var img = document.getElementById("canvasToThumb"),
	    	    	
	    	$img = $(img),
		    imgW = img.width, 
		   	imgH = img.height;	
	    
	    var rY = imgH / $img.height(),
	        rX = imgW / $img.width();
       
        console.log(coords); 

        canvas.width = coords.w;  
        canvas.height =  coords.h;  

	    context.drawImage(img, (coords.x * rX), (coords.y * rY), (coords.w * rX), (coords.h * rY), 0, 0, canvas.width, canvas.height);

	    var img = new Image();
		
		img.setAttribute('crossOrigin', 'anonymous');
		img.src = context.canvas.toDataURL("image/png");

	   	var divimg = document.getElementById('divimg');

	   	divimg.innerHTML = ''; 
	   	divimg.appendChild(img); 
       	    	  	 
	});
	</script>
</body>


</html>